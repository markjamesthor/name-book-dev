<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배경 제거 프로토타입</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            text-align: center;
            padding: 20px 0 16px;
            border-bottom: 1px solid #2a2a2a;
            margin-bottom: 24px;
        }

        header h1 {
            font-size: 22px;
            font-weight: 600;
            color: #fff;
        }

        header p {
            font-size: 13px;
            color: #888;
            margin-top: 4px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #3a3a3a;
            border-radius: 12px;
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #1a1a1a;
            margin-bottom: 20px;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #4a9eff;
            background: #1a2a3a;
        }

        .upload-area .icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .upload-area .label {
            font-size: 15px;
            color: #bbb;
        }

        .upload-area .hint {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
        }

        .upload-area.has-file {
            padding: 16px 24px;
            border-style: solid;
            border-color: #333;
        }

        .upload-area.has-file .icon { font-size: 20px; margin-bottom: 0; }
        .upload-area.has-file .label { font-size: 13px; }
        .upload-area.has-file .hint { display: none; }

        .file-info {
            display: none;
            align-items: center;
            gap: 12px;
            justify-content: center;
        }

        .upload-area.has-file .file-info { display: flex; }
        .upload-area.has-file .upload-prompt { display: none; }

        .file-info .file-name {
            font-size: 14px;
            color: #ccc;
        }

        .file-info .change-btn {
            font-size: 12px;
            color: #4a9eff;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 20px;
            align-items: end;
            margin-bottom: 24px;
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2a2a2a;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .model-options {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .model-options input[type="radio"] { display: none; }

        .model-options .model-label {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            border: 1px solid #3a3a3a;
            background: #222;
            color: #bbb;
            transition: all 0.15s;
        }

        .model-options input[type="radio"]:checked + .model-label {
            background: #4a9eff;
            border-color: #4a9eff;
            color: #fff;
        }

        .model-options .model-label:hover {
            border-color: #555;
        }

        .resolution-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .resolution-control input[type="range"] {
            flex: 1;
            accent-color: #4a9eff;
            height: 6px;
        }

        .resolution-control .res-value {
            font-size: 14px;
            font-weight: 600;
            color: #4a9eff;
            min-width: 60px;
            text-align: right;
        }

        .original-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #bbb;
            cursor: pointer;
            user-select: none;
            margin-left: 4px;
        }

        .original-toggle input[type="checkbox"] {
            accent-color: #4a9eff;
            width: 15px;
            height: 15px;
        }

        .resolution-control.disabled input[type="range"] {
            opacity: 0.3;
            pointer-events: none;
        }

        .resolution-control.disabled .res-value {
            opacity: 0.3;
        }

        .smart-crop-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #bbb;
            cursor: pointer;
            user-select: none;
        }

        .smart-crop-toggle input[type="checkbox"] {
            accent-color: #4a9eff;
            width: 15px;
            height: 15px;
        }

        /* Compare Section */
        .compare-section {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .compare-section.visible { display: grid; }

        .compare-section.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        #crop-info {
            padding: 6px 12px;
            font-size: 11px;
            color: #888;
            text-align: center;
            border-top: 1px solid #2a2a2a;
        }

        .compare-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
        }

        .compare-card .card-title {
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #2a2a2a;
        }

        .compare-card .card-body {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            position: relative;
        }

        .compare-card .card-body img,
        .compare-card .card-body canvas {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
        }

        /* Checkerboard background for transparency */
        .checker-bg {
            background-image:
                linear-gradient(45deg, #2a2a2a 25%, transparent 25%),
                linear-gradient(-45deg, #2a2a2a 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #2a2a2a 75%),
                linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            background-color: #1e1e1e;
        }

        /* Preview Section */
        .preview-section {
            display: none;
            margin-bottom: 24px;
        }

        .preview-section.visible { display: block; }

        .preview-section .section-title {
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .preview-card {
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #2a2a2a;
        }

        .preview-card .preview-label {
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            color: #888;
            text-align: center;
            background: #1a1a1a;
            border-bottom: 1px solid #2a2a2a;
        }

        .preview-card canvas {
            display: block;
            width: 100%;
            height: auto;
        }

        /* BGQA Badge */
        .bgqa-badge {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .bgqa-badge.visible { display: inline-flex; }
        .bgqa-badge.pass { background: #1a3a1a; color: #4caf50; border: 1px solid #2a5a2a; }
        .bgqa-badge.fail { background: #3a1a1a; color: #f44336; border: 1px solid #5a2a2a; }

        /* Processing Info */
        .processing-info {
            display: none;
            font-size: 12px;
            color: #666;
            margin-bottom: 16px;
        }

        .processing-info.visible { display: block; }

        /* Download */
        .download-section {
            display: none;
            text-align: center;
            padding: 16px 0;
        }

        .download-section.visible { display: block; }

        .download-btn {
            padding: 12px 32px;
            background: #2a8a4a;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .download-btn:hover { background: #238a42; }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }

        .loading-overlay.visible {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top-color: #4a9eff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-overlay .loading-text {
            font-size: 14px;
            color: #ccc;
        }

        .loading-overlay .loading-time {
            font-size: 12px;
            color: #888;
        }

        /* Error */
        .error-message {
            display: none;
            background: #3a1a1a;
            border: 1px solid #5a2a2a;
            border-radius: 8px;
            padding: 12px 16px;
            color: #f44336;
            font-size: 13px;
            margin-bottom: 16px;
        }

        .error-message.visible { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>배경 제거 프로토타입</h1>
            <p>7개 모델 비교 테스트 (BiRefNet / RMBG2 / BEN2 / remove.bg)</p>
        </header>

        <!-- Upload Area -->
        <div id="upload-area" class="upload-area">
            <div class="upload-prompt">
                <div class="icon">+</div>
                <div class="label">이미지를 드래그하거나 클릭하여 선택</div>
                <div class="hint">JPG, PNG, WebP, HEIC (최대 20MB)</div>
            </div>
            <div class="file-info">
                <span class="file-name" id="file-name"></span>
                <span class="change-btn">변경</span>
            </div>
        </div>
        <input type="file" id="file-input" accept="image/*,.heic,.heif" hidden>

        <!-- Error Message -->
        <div id="error-message" class="error-message"></div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label>모델 선택</label>
                <div class="model-options">
                    <input type="radio" name="model" id="m-portrait" value="portrait" checked>
                    <label for="m-portrait" class="model-label">Portrait</label>

                    <input type="radio" name="model" id="m-hr" value="hr">
                    <label for="m-hr" class="model-label">HR</label>

                    <input type="radio" name="model" id="m-hr-matting" value="hr-matting">
                    <label for="m-hr-matting" class="model-label">HR-Matting</label>

                    <input type="radio" name="model" id="m-dynamic" value="dynamic">
                    <label for="m-dynamic" class="model-label">Dynamic</label>

                    <input type="radio" name="model" id="m-rmbg2" value="rmbg2">
                    <label for="m-rmbg2" class="model-label">RMBG2</label>

                    <input type="radio" name="model" id="m-ben2" value="ben2">
                    <label for="m-ben2" class="model-label">BEN2</label>

                    <input type="radio" name="model" id="m-removebg" value="removebg">
                    <label for="m-removebg" class="model-label" style="border-color:#4a6; color:#4a6;">remove.bg</label>
                </div>
            </div>

            <div class="control-group">
                <label>처리 해상도</label>
                <div class="resolution-control" id="resolution-control">
                    <input type="range" id="resolution-slider" min="512" max="2560" value="1440" step="64">
                    <span class="res-value" id="res-value">1440px</span>
                    <label class="original-toggle">
                        <input type="checkbox" id="original-check">원본
                    </label>
                </div>
            </div>

            <div class="control-group">
                <label>마스크 리파인</label>
                <div class="model-options">
                    <input type="radio" name="refine" id="r-none" value="none" checked>
                    <label for="r-none" class="model-label">없음</label>

                    <input type="radio" name="refine" id="r-guided" value="guided">
                    <label for="r-guided" class="model-label">Guided Filter</label>

                    <input type="radio" name="refine" id="r-pymatting" value="pymatting">
                    <label for="r-pymatting" class="model-label">PyMatting</label>

                    <input type="radio" name="refine" id="r-fg" value="fg_estimate">
                    <label for="r-fg" class="model-label">FG Estimate</label>
                </div>
            </div>

            <div class="control-group">
                <label>스마트 크롭</label>
                <label class="smart-crop-toggle">
                    <input type="checkbox" id="smart-crop-check" checked>
                    크롭 적용
                </label>
                <div class="radio-group" style="margin-top: 6px;">
                    <label><input type="radio" name="crop-mode" value="person" checked> 인물</label>
                    <label><input type="radio" name="crop-mode" value="object"> 물건</label>
                </div>
            </div>

            <div class="control-group">
                <label>마스크 해상도</label>
                <div class="radio-group">
                    <label><input type="radio" name="seg-size" value="256"> 256</label>
                    <label><input type="radio" name="seg-size" value="384"> 384</label>
                    <label><input type="radio" name="seg-size" value="512" checked> 512</label>
                    <label><input type="radio" name="seg-size" value="768"> 768</label>
                    <label><input type="radio" name="seg-size" value="1024"> 1024</label>
                </div>
            </div>

        </div>

        <!-- Compare: Original vs Result -->
        <div id="compare-section" class="compare-section">
            <div class="compare-card">
                <div class="card-title">원본 이미지</div>
                <div class="card-body">
                    <img id="original-preview" alt="원본">
                </div>
            </div>
            <div id="cropped-card" class="compare-card" style="display:none;">
                <div class="card-title">스마트 크롭</div>
                <div class="card-body">
                    <canvas id="cropped-canvas"></canvas>
                </div>
                <div id="crop-info"></div>
            </div>
            <div class="compare-card">
                <div class="card-title">배경 제거 결과</div>
                <div class="card-body checker-bg">
                    <canvas id="result-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- BGQA Badge -->
        <div id="bgqa-badge" class="bgqa-badge"></div>

        <!-- Processing Info -->
        <div id="processing-info" class="processing-info"></div>

        <!-- 3-way Preview -->
        <div id="preview-section" class="preview-section">
            <div class="section-title">배경색 미리보기</div>
            <div class="preview-grid">
                <div class="preview-card">
                    <div class="preview-label">흰색 배경</div>
                    <canvas id="preview-white"></canvas>
                </div>
                <div class="preview-card">
                    <div class="preview-label">회색 배경</div>
                    <canvas id="preview-gray"></canvas>
                </div>
                <div class="preview-card">
                    <div class="preview-label">검정 배경</div>
                    <canvas id="preview-black"></canvas>
                </div>
            </div>
        </div>

        <!-- Download -->
        <div id="download-section" class="download-section">
            <button id="download-btn" class="download-btn">PNG 다운로드 (투명 배경)</button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">배경을 제거하고 있습니다...</div>
        <div class="loading-time" id="loading-time"></div>
    </div>

    <script type="module" src="js/bgRemoveApp.js"></script>
</body>
</html>
